name: XML Syntax Check

description: |
  Validates that all XML files installed by a package are well-formed
  using xmlwf from expat. Searches the specified path (default: usr/share)
  for .xml files and checks each one for XML well-formedness errors.
  Any malformed XML causes the test to fail.

needs:
  packages:
    - expat

inputs:
  path:
    description: |
      Directory path to search for XML files (relative to /).
      Defaults to usr/share, which covers the most common install locations
      for documentation and protocol definition XML files.
    default: "usr/share"

pipeline:
  - name: Check XML files are well-formed
    runs: |
      set -euo pipefail
      path="/${{inputs.path}}"
      xml_files=$(find "$path" -name "*.xml" -type f)
      if [ -z "$xml_files" ]; then
        echo "ERROR: no .xml files found under $path"
        exit 1
      fi
      count=0
      echo "$xml_files" | while read -r f; do
        xmlwf "$f"
        count=$((count + 1))
      done
      echo "XML validation passed"
